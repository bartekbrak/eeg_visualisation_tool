<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>{{ title if title else "Bokeh Plot" }}</title>
	{{ plot_resources|indent(8) }}
	{{ plot_script|indent(8) }}
<script>
document.addEventListener("DOMContentLoaded", function(event) {
    video = document.querySelector('video');
	ready_to_play = true;
    hover_position = 0;
    var progress = 0,
        line_y = {{ progress_bar_y }},
        progress_bar = Bokeh.Collections('ColumnDataSource').get('{{ progress_bar_id }}'),
        update_resolution = 10,
        bk_canvas_events1 = document.getElementsByClassName('bk-canvas-events')[0],
        bk_canvas_events2 = document.getElementsByClassName('bk-canvas-events')[1]
    ;
    console.log('Progress bar CDS id: {{ progress_bar_id }}');
    
	function update_progress_bar() {
	    progress = parseInt(video.currentTime * 1000);
	    progress_bar.set('data', {x: [progress, progress], y : line_y});
	    setTimeout(update_progress_bar, update_resolution);
	}
    video.addEventListener('ended', function(){ready_to_play = true;});
    update_progress_bar();

	bk_canvas_events1.addEventListener("dblclick", function () {
        video.pause();
        video.currentTime = hover_position;
        ready_to_play = true;
    });
 	bk_canvas_events2.addEventListener("dblclick", function () {
        video.pause();
        video.currentTime = hover_position;
        ready_to_play = true;
	});
    toggle_line = function(cid) {
        var line = Bokeh.Collections("ColumnDataSource").get(cid);
        var line_data = line.get('data'),
            orig_data = line.get('orig_data');
        if (orig_data == undefined) line.set('orig_data', line_data);
        if (Object.keys(line_data).length === 0) {
            line.set('data', orig_data)
        } else {
            line.set('data', {})
        }
    }
})
</script>
<style>
    body {background-color: #200000}
    .bk-logo { display:none !important; }
    .color_square {
        display: inline-block;
        padding: 5px;
        border-radius: 10px;
        border: 2px solid white;
        color: white;
        font-family: sans-serif;
        font-weight: 900;
        cursor: pointer;
    }

</style>

</head>
<body>
	<center>
	    <video  height=300>
	   		<source type="video/mp4" src="data:video/mp4;base64,{{video_data}}">
		</video>
		{{ plot_div|indent(8) }}
	</center>
{% for item in grouped_plot_data.values() %}
    <div class="color_square" style="background-color: {{ item['color'] }}" onclick="toggle_line('{{ item.source._id }}')">
    <table>
    {% for filter, value in item['description'].items() %}
        <tr><td>{{ filter }}:</td><td>{{ value }}</td></tr>
    {% endfor %}
        </table>

        </div>
{% endfor %}
</body>
</html>
